<!DOCTYPE html>
    <html lang="en">
        <head>
            <title>The Lunchbox - Menu Upload</title>
            <meta charset="utf-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <link rel="stylesheet" href="style.css">
            <link rel="icon" type="image/x-icon" href="content/favicon.png">
            <script type="module">
                // Import only what we need
                import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
                import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
                import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

                const firebaseConfig = {
                    apiKey: "AIzaSyCB5LWzxJOn9KmNtF5kgNdZUuzKyFzvQuA",
                    authDomain: "lunchbox-16e19.firebaseapp.com",
                    projectId: "lunchbox-16e19",
                    storageBucket: "lunchbox-16e19.firebasestorage.app",
                    messagingSenderId: "183226656948",
                    appId: "1:183226656948:web:a4a7cc97534be3eb714fe1"
                };

                // Initialize Firebase
                const app = initializeApp(firebaseConfig);
                const db = getFirestore(app);
                const auth = getAuth();

                // Make submitForm available globally
                window.submitForm = async function(event) {
                    if (event) {
                        event.preventDefault();
                    }
                    
                    try {
                        // Get authentication credentials
                        const email = document.getElementById('emailINPUT').value;
                        const password = document.getElementById('passwordINPUT').value;

                        // First authenticate
                        await signInWithEmailAndPassword(auth, email, password);
                        
                        // If authentication successful, proceed with menu update
                        const menuData = {
                            tuesday: {
                                date: document.getElementById('dateINPUT1').value,
                                entree: document.getElementById('entreeINPUT1').value,
                                soup: document.getElementById('soupINPUT1').value,
                                salad: document.getElementById('saladINPUT1').value,
                                side: document.getElementById('sideINPUT1').value,
                                dessert: document.getElementById('dessertINPUT1').value,
                                closed: document.getElementById('closedCHECKBOX1').checked ? "CLOSED" : ""
                            },
                            wednesday: {
                                date: document.getElementById('dateINPUT2').value,
                                entree: document.getElementById('entreeINPUT2').value,
                                soup: document.getElementById('soupINPUT2').value,
                                salad: document.getElementById('saladINPUT2').value,
                                side: document.getElementById('sideINPUT2').value,
                                dessert: document.getElementById('dessertINPUT2').value,
                                closed: document.getElementById('closedCHECKBOX2').checked ? "CLOSED" : ""
                            },
                            thursday: {
                                date: document.getElementById('dateINPUT3').value,
                                entree: document.getElementById('entreeINPUT3').value,
                                soup: document.getElementById('soupINPUT3').value,
                                salad: document.getElementById('saladINPUT3').value,
                                side: document.getElementById('sideINPUT3').value,
                                dessert: document.getElementById('dessertINPUT3').value,
                                closed: document.getElementById('closedCHECKBOX3').checked ? "CLOSED" : ""
                            }
                        };

                        // Try to write to Firestore (no auth needed now)
                        await setDoc(doc(db, "menu", "current"), menuData);
                        alert("Menu updated successfully!");
                        
                        // Clear all inputs except email/password
                        const inputs = document.querySelectorAll('input[type="text"]:not(#emailINPUT):not(#passwordINPUT)');
                        inputs.forEach(input => input.value = '');
                        const checkboxes = document.querySelectorAll('input[type="checkbox"]');
                        checkboxes.forEach(checkbox => checkbox.checked = false);
                        
                    } catch (error) {
                        console.error("Error:", error);
                        if (error.code === 'auth/wrong-password' || error.code === 'auth/user-not-found') {
                            alert("Invalid email or password");
                        } else if (error.code === 'permission-denied') {
                            alert("You don't have permission to update the menu");
                        } else {
                            alert("Error updating menu: " + error.message);
                        }
                    }
                };

                // Add form submit listener
                document.addEventListener('DOMContentLoaded', () => {
                    const form = document.getElementById('menuUploadForm');
                    form.addEventListener('submit', submitForm);
                });
            </script>        </head>
            <nav>
                <div class="nav-upload-middle">
                    <img id="logo-upload-middle" src="content/lunchboxWithText.png" alt="lunchboxLogoWithText">
                </div>
            </nav>
            <main>
                <form id="menuUploadForm">
                    <div class="upload-container">
                        <div class="upload-card">
                            <div class="upload-form">
                                <input id="dateINPUT1" type="text" placeholder="Tuesday - Date (JAN 1)" style="background-color:silver">
                                <input id="entreeINPUT1" type="text" placeholder="Tuesday - Entree" style="background-color:silver">
                                <input id="soupINPUT1" type="text" placeholder="Tuesday - Soups" style="background-color:silver">
                                <input id="saladINPUT1" type="text" placeholder="Tuesday - Salads" style="background-color:silver">
                                <input id="sideINPUT1" type="text" placeholder="Tuesday - Sides" style="background-color:silver">
                                <input id="dessertINPUT1" type="text" placeholder="Tuesday - Desserts" style="background-color:silver">
                                <label class="checkbox-label">
                                    <input id="closedCHECKBOX1" type="checkbox" class="custom-checkbox">
                                    <span class="checkbox-text">closed</span>
                                </label>
                            </div>
                        </div>
                        <div class="upload-card">
                            <div class="upload-form">
                                <input id="dateINPUT2" type="text" placeholder="Wednesday - Date (JAN 1)" style="background-color:silver">
                                <input id="entreeINPUT2" type="text" placeholder="Wednesday - Entree" style="background-color:silver">
                                <input id="soupINPUT2" type="text" placeholder="Wednesday - Soups" style="background-color:silver">
                                <input id="saladINPUT2" type="text" placeholder="Wednesday - Salads" style="background-color:silver">
                                <input id="sideINPUT2" type="text" placeholder="Wednesday - Sides" style="background-color:silver">
                                <input id="dessertINPUT2" type="text" placeholder="Wednesday - Desserts" style="background-color:silver">
                                <label class="checkbox-label">
                                    <input id="closedCHECKBOX2" type="checkbox" class="custom-checkbox">
                                    <span class="checkbox-text">closed</span>
                                </label>
                            </div>
                        </div>
                        <div class="upload-card">
                            <div class="upload-form">
                                <input id="dateINPUT3" type="text" placeholder="Thursday - Date (JAN 1)" style="background-color:silver">
                                <input id="entreeINPUT3" type="text" placeholder="Thursday - Entree" style="background-color:silver">
                                <input id="soupINPUT3" type="text" placeholder="Thursday - Soups" style="background-color:silver">
                                <input id="saladINPUT3" type="text" placeholder="Thursday - Salads" style="background-color:silver">
                                <input id="sideINPUT3" type="text" placeholder="Thursday - Sides" style="background-color:silver">
                                <input id="dessertINPUT3" type="text" placeholder="Thursday - Desserts" style="background-color:silver">
                                <label class="checkbox-label">
                                    <input id="closedCHECKBOX3" type="checkbox" class="custom-checkbox">
                                    <span class="checkbox-text">closed</span>
                                </label>
                            </div>
                        </div>
                        <div class="upload-card">
                            <div class="upload-form">
                                <h2 class="current-site-text"><a href="https://sictccs.github.io/LunchBox/index.html" target="_blank">current menu &#x2197;</a></h2>
                                <input id="emailINPUT" type="email" placeholder="Email" required style="background-color:#e56b6f">
                                <input id="passwordINPUT" type="password" placeholder="Password" required style="background-color:#e56b6f">
                                <button id="submitBTN" type="submit">publish</button>
                                <p>* publishing replaces all current menu details</p>
                            </div>
                        </div>
                    </div>
                </form>
                <a class="emailHinter">Email</a>
                <textarea class="emailUploader">
                </textarea>
            </main>
            <footer>
                &copy; <a class="no-style-link" href="https://github.com/maekyngrigs10">Maekyn Grigsby</a> & <a class="no-style-link" href="https://github.com/tytichenor">Ty Tichenor</a><br>
                The Lunchbox <br>
                1901 Lynch Rd, Evansville, IN 47711 <br>
                <a href="https://sictc.evscschools.com/"><img src="content/footerSICTC.png" style="width:150px;height:75px;" alt="footerSICTC"></a>
            </footer>
        </body>
</html>
